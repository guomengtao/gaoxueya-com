<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>B站视频分页展示（接口分页）</title>
  <style>
    body { margin:0; font-family:Arial; background:#f4f4f4; padding:20px; }
    h2 { margin-bottom:10px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:16px; }
    .card { background:#fff; border-radius:12px; overflow:hidden; box-shadow:0 4px 12px rgba(0,0,0,0.1); cursor:pointer; transition: transform 0.2s; }
    .card:hover { transform: translateY(-4px); }
    .card img { width:100%; height:140px; object-fit:cover; }
    .card .info { padding:10px; font-size:13px; color:#333; }
    .card .info div { margin-bottom:4px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .pagination { margin-top:20px; text-align:center; }
    .pagination button { margin:0 5px; padding:6px 12px; border:none; border-radius:6px; background:#007bff; color:white; cursor:pointer; }
    .pagination button:disabled { background:#ccc; cursor:not-allowed; }
    /* 弹窗 */
    .modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); align-items:center; justify-content:center; }
    .modal-content { background:#000; border-radius:12px; padding:10px; max-width:800px; width:90%; }
    .modal iframe { width:100%; height:450px; border:none; border-radius:8px; }
    .close { position:absolute; top:20px; right:20px; font-size:24px; color:white; cursor:pointer; }
    .summary { margin-bottom:10px; font-size:14px; color:#555; }
  </style>
</head>
<body>
  <h2>B站视频分页展示（接口分页）</h2>
  <div class="summary" id="summaryInfo"></div>
  <div class="grid" id="videoGrid"></div>
  <div class="pagination">
    <button id="prevBtn">上一页</button>
    <span id="pageInfo"></span>
    <button id="nextBtn">下一页</button>
  </div>

  <!-- 弹窗播放 -->
  <div class="modal" id="videoModal">
    <div class="close" onclick="closeModal()">✖</div>
    <div class="modal-content">
      <iframe id="player" allowfullscreen></iframe>
    </div>
  </div>

  <script>
    let currentPage = 1;
    const pageSize = 10;
    const keyword = "高血压";
    let totalPages = 1;

    function fetchData(page = 1) {
      fetch(`https://api.bilibili.com/x/web-interface/search/all/v2?keyword=${encodeURIComponent(keyword)}&page=${page}&pagesize=${pageSize}`)
        .then(res => res.json())
        .then(data => {
          totalPages = data.data.numPages || 1;

          document.getElementById("summaryInfo").innerText = 
            `code: ${data.code}, message: ${data.message}, 当前页: ${data.data.page}, 每页大小: ${data.data.pagesize}, 总结果: ${data.data.numResults}, 总页数: ${totalPages}`;

          let videos = [];
          data.data.result.forEach(item => {
            if(item.result_type === "video"){
              item.data.forEach(v => {
                videos.push({
                  title: v.title.replace(/<[^>]+>/g,""),
                  bvid: v.bvid,
                  pic: "https://images.weserv.nl/?url=" + v.pic.replace(/^\/\//,""),
                  author: v.author,
                  play: v.stat?.view || null,
                  favorites: v.stat?.favorite || null,
                  video_review: v.stat?.reply || null,
                  duration: v.duration,
                  tag: v.tag,
                  description: v.description,
                  pubdate: v.pubdate
                });
              });
            }
          });

          renderPage(videos);
        });
    }

    function renderPage(videos){
      const grid = document.getElementById("videoGrid");
      grid.innerHTML = "";

      videos.forEach(v => {
        const div = document.createElement("div");
        div.className = "card";

        let infoHtml = `<div class="info">`;
        infoHtml += `<div title="${v.title}"><strong>${v.title}</strong></div>`;
        if(v.author) infoHtml += `<div>作者: ${v.author}</div>`;
        if(v.play) infoHtml += `<div>播放量: ${v.play}</div>`;
        if(v.favorites) infoHtml += `<div>收藏: ${v.favorites}</div>`;
        if(v.video_review) infoHtml += `<div>评论: ${v.video_review}</div>`;
        if(v.duration) infoHtml += `<div>时长: ${v.duration}</div>`;
        if(v.tag) infoHtml += `<div>标签: ${v.tag}</div>`;
        if(v.description) infoHtml += `<div>简介: ${v.description}</div>`;
        if(v.pubdate) infoHtml += `<div>发布时间: ${new Date(v.pubdate*1000).toLocaleDateString()}</div>`;
        infoHtml += `</div>`;

        div.innerHTML = `<img src="${v.pic}" alt="${v.title}">${infoHtml}`;
        div.onclick = () => openModal(v.bvid);
        grid.appendChild(div);
      });

      document.getElementById("pageInfo").innerText = `第 ${currentPage} 页 / 共 ${totalPages} 页`;
      document.getElementById("prevBtn").disabled = currentPage === 1;
      document.getElementById("nextBtn").disabled = currentPage >= totalPages;
    }

    document.getElementById("prevBtn").onclick = () => {
      if(currentPage > 1){
        currentPage--;
        fetchData(currentPage);
      }
    };

    document.getElementById("nextBtn").onclick = () => {
      if(currentPage < totalPages){
        currentPage++;
        fetchData(currentPage);
      }
    };

    function openModal(bvid){
      const modal = document.getElementById("videoModal");
      const player = document.getElementById("player");
      player.src = `//player.bilibili.com/player.html?bvid=${bvid}&autoplay=1`;
      modal.style.display = "flex";
    }

    function closeModal(){
      const modal = document.getElementById("videoModal");
      const player = document.getElementById("player");
      player.src = "";
      modal.style.display = "none";
    }

    // 默认加载第一页
    fetchData(currentPage);
  </script>
</body>
</html>
